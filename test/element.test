
UTest({
	$config: {
		timeout: 4000
	},
	'`with` test' () {
		var div = mask.render(`
			div {
				section.foo > 'Foo';
				aside > span #Span;
			}
		`);
		
		DomTest(div, `
				
			with (section) {
				eq('text', 'Foo');
			}
			with (aside > span) {
				eq('attr', 'id', 'Span');
			}
			with (.foo) {
				eq('text', 'Foo');
				eq('prop', 'tagName', 'SECTION');
			}
		`);
	},
	
	'embeded javascript' () {
		var div = mask.render(`
			div > section > 'Foo'
		`);
		
		DomTest(div, `
			eq('prop', 'tagName', 'DIV');
			
			find (section) {
				slot changeText ($el) {
					$el.text('Baz');
				}
				eq('text', 'Baz');
			}
		`);
	},
	'await timeout' () {
		var div = mask.render('div');
		setTimeout(function(){
			$(div).appendMask('section > "Baz"');
		}, 200);
		
		return DomTest(div, `
			await (400) {
				eq('text', 'Baz');
			}
		`);
	},
	'await element' () {
		var div = mask.render('div');
		setTimeout(function(){
			$(div).appendMask('section > "Baz"');
		}, 400);
		
		return DomTest(div, `
			await (section) {
				eq('text', 'Baz');
			}
		`);
	},
	'events test' () {
		var div = mask.render(`
			div {
				button > 'Foo'
			}
			input value=Foo;
		`);
		
		var button =  $(div).find('button').get(0);
		// add native
		button.addEventListener('click', function(){
			this.textContent = 'Baz';
		}, false);
		
		var input = $(div).filter('input').get(0);
		input.addEventListener('keydown', assert.await(function(e){
			logger.log('<keydown>', e.keyCode);
		}), true);
		input.addEventListener('keyup', assert.await(function(e){
			logger.log('<keyup>', e.keyCode);
		}), true);
		input.addEventListener('keypress', assert.await(function(e){
			logger.log('<keypress>', e.keyCode);
		}), true);
		
		var test = `
			with (button) {
				
				text('Foo');
				
				do click;
				text('Baz');
			}
			with (input) {
				val('Foo');
				
				do press('A');
				val('AFoo');
			}		
		`;
		return DomTest(div, test);
	},
	
	'call test' () {
		var div = mask.render(`
			div > 'Foo'
		`);
		var test = `
			text Foo;
			call text('Baz');
			text Baz;
		`;
		
		return DomTest(div, test);
	},
	
	'className test' () {
		var div = mask.render(`
			div.foo;
		`);
		var test = `
			hasClass foo;
			hasClass ('baz', false);
			
			call addClass('baz');
			hasClass ('baz');
		`;
		
		return DomTest(div, test);
	}
	
});